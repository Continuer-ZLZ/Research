{"remainingRequest":"D:\\Code\\Research\\research-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Code\\Research\\research-ui\\src\\views\\project\\acceptance\\index.vue?vue&type=style&index=0&id=9095fd2c&scoped=true&lang=css","dependencies":[{"path":"D:\\Code\\Research\\research-ui\\src\\views\\project\\acceptance\\index.vue","mtime":1740900783298},{"path":"D:\\Code\\Research\\research-ui\\node_modules\\css-loader\\dist\\cjs.js","mtime":1740793408139},{"path":"D:\\Code\\Research\\research-ui\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1740793417979},{"path":"D:\\Code\\Research\\research-ui\\node_modules\\postcss-loader\\src\\index.js","mtime":1740793410952},{"path":"D:\\Code\\Research\\research-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1740793404454},{"path":"D:\\Code\\Research\\research-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":1740793415933}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoubXQyMCB7CiAgbWFyZ2luLXRvcDogMjBweDsKfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqVA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/project/acceptance","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <el-card class=\"box-card\">\n      <div slot=\"header\" class=\"clearfix\">\n        <span>项目验收申请</span>\n      </div>\n\n      <el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"120px\">\n        <el-form-item label=\"项目名称\">\n          <el-input v-model=\"projectInfo.projectName\" disabled />\n        </el-form-item>\n        <el-form-item label=\"验收标题\" prop=\"acceptanceTitle\">\n          <el-input v-model=\"form.acceptanceTitle\" placeholder=\"请输入验收标题\" />\n        </el-form-item>\n        <el-form-item label=\"验收内容\" prop=\"acceptanceContent\">\n          <el-input type=\"textarea\" v-model=\"form.acceptanceContent\" :rows=\"4\" placeholder=\"请输入验收内容\" />\n        </el-form-item>\n        <el-form-item label=\"验收材料\">\n          <el-upload\n            class=\"upload-demo\"\n            ref=\"upload\"\n            action=\"/api/common/upload\"\n            :on-preview=\"handlePreview\"\n            :on-remove=\"handleRemove\"\n            :on-success=\"handleUploadSuccess\"\n            :file-list=\"fileList\"\n            :headers=\"headers\"\n            :before-upload=\"beforeUpload\"\n            multiple>\n            <el-button size=\"small\" type=\"primary\">点击上传</el-button>\n            <div slot=\"tip\" class=\"el-upload__tip\">可上传验收相关文件，单个文件不超过10MB</div>\n          </el-upload>\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"submitForm\">提交验收申请</el-button>\n          <el-button @click=\"cancel\">取消</el-button>\n        </el-form-item>\n      </el-form>\n    </el-card>\n\n    <!-- 验收记录列表 -->\n    <el-card class=\"box-card mt20\">\n      <div slot=\"header\" class=\"clearfix\">\n        <span>验收记录</span>\n      </div>\n\n      <el-table v-loading=\"loading\" :data=\"acceptanceList\">\n        <el-table-column label=\"验收编号\" align=\"center\" prop=\"acceptanceCode\" />\n        <el-table-column label=\"验收标题\" align=\"center\" prop=\"acceptanceTitle\" />\n        <el-table-column label=\"申请时间\" align=\"center\" prop=\"applyTime\" width=\"180\" />\n        <el-table-column label=\"验收时间\" align=\"center\" prop=\"acceptanceTime\" width=\"180\" />\n        <el-table-column label=\"验收人\" align=\"center\" prop=\"acceptanceUserName\" />\n        <el-table-column label=\"验收状态\" align=\"center\">\n          <template slot-scope=\"scope\">\n            <dict-tag :options=\"dict.type.acceptance_status\" :value=\"scope.row.status\"/>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"操作\" align=\"center\" class-name=\"small-padding fixed-width\">\n          <template slot-scope=\"scope\">\n            <el-button\n              size=\"mini\"\n              type=\"text\"\n              icon=\"el-icon-view\"\n              @click=\"handleView(scope.row)\"\n            >查看</el-button>\n            <el-button\n              size=\"mini\"\n              type=\"text\"\n              icon=\"el-icon-edit\"\n              @click=\"handleAcceptance(scope.row)\"\n              v-if=\"scope.row.status === '0' && checkPermission(['project:acceptance:approve'])\"\n            >验收</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n\n      <pagination\n        v-show=\"total>0\"\n        :total=\"total\"\n        :page.sync=\"queryParams.pageNum\"\n        :limit.sync=\"queryParams.pageSize\"\n        @pagination=\"getList\"\n      />\n    </el-card>\n\n    <!-- 验收详情对话框 -->\n    <el-dialog :title=\"title\" :visible.sync=\"open\" width=\"600px\" append-to-body>\n      <el-descriptions :column=\"2\" border>\n        <el-descriptions-item label=\"验收编号\">{{ viewForm.acceptanceCode }}</el-descriptions-item>\n        <el-descriptions-item label=\"验收标题\">{{ viewForm.acceptanceTitle }}</el-descriptions-item>\n        <el-descriptions-item label=\"申请时间\">{{ viewForm.applyTime }}</el-descriptions-item>\n        <el-descriptions-item label=\"验收状态\">\n          <dict-tag :options=\"dict.type.acceptance_status\" :value=\"viewForm.status\"/>\n        </el-descriptions-item>\n        <el-descriptions-item label=\"验收内容\" :span=\"2\">{{ viewForm.acceptanceContent }}</el-descriptions-item>\n        <el-descriptions-item label=\"验收材料\" :span=\"2\">\n          <el-link\n            v-if=\"viewForm.materialsPath\"\n            type=\"primary\"\n            :href=\"viewForm.materialsPath\"\n            target=\"_blank\"\n          >下载材料</el-link>\n          <span v-else>无</span>\n        </el-descriptions-item>\n        <el-descriptions-item label=\"验收评分\" v-if=\"viewForm.status !== '0'\">{{ viewForm.score }}</el-descriptions-item>\n        <el-descriptions-item label=\"验收人\" v-if=\"viewForm.status !== '0'\">{{ viewForm.acceptanceUserName }}</el-descriptions-item>\n        <el-descriptions-item label=\"验收意见\" :span=\"2\" v-if=\"viewForm.status !== '0'\">{{ viewForm.opinion }}</el-descriptions-item>\n      </el-descriptions>\n\n      <div v-if=\"isAcceptance\" class=\"mt20\">\n        <el-divider content-position=\"center\">验收结果</el-divider>\n        <el-form ref=\"acceptanceForm\" :model=\"acceptanceForm\" :rules=\"acceptanceRules\" label-width=\"100px\">\n          <el-form-item label=\"验收评分\" prop=\"score\">\n            <el-rate\n              v-model=\"acceptanceForm.score\"\n              :max=\"10\"\n              show-score\n              :colors=\"colors\"\n            ></el-rate>\n          </el-form-item>\n          <el-form-item label=\"验收意见\" prop=\"opinion\">\n            <el-input\n              type=\"textarea\"\n              v-model=\"acceptanceForm.opinion\"\n              :rows=\"3\"\n              placeholder=\"请输入验收意见\"\n            ></el-input>\n          </el-form-item>\n          <el-form-item label=\"验收结果\" prop=\"status\">\n            <el-radio-group v-model=\"acceptanceForm.status\">\n              <el-radio label=\"1\">通过</el-radio>\n              <el-radio label=\"2\">不通过</el-radio>\n            </el-radio-group>\n          </el-form-item>\n        </el-form>\n      </div>\n\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"open = false\">关 闭</el-button>\n        <el-button type=\"primary\" @click=\"submitAcceptance\" v-if=\"isAcceptance\">提 交</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { getToken } from \"@/utils/auth\";\nimport { getProjectInfo } from \"@/api/project/info\";\nimport { listAcceptance, getAcceptance, addAcceptance, completeAcceptance } from \"@/api/project/acceptance\";\nimport { checkPermission } from \"@/utils/permission\";\n\nexport default {\n  name: \"ProjectAcceptance\",\n  dicts: ['acceptance_status'],\n  data() {\n    return {\n      // 遮罩层\n      loading: false,\n      // 项目ID\n      projectId: null,\n      // 项目信息\n      projectInfo: {},\n      // 验收记录列表\n      acceptanceList: [],\n      // 总条数\n      total: 0,\n      // 是否显示弹出层\n      open: false,\n      // 弹出层标题\n      title: \"\",\n      // 是否进行验收\n      isAcceptance: false,\n      // 查询参数\n      queryParams: {\n        pageNum: 1,\n        pageSize: 10,\n        projectId: null\n      },\n      // 表单参数\n      form: {\n        projectId: null,\n        acceptanceTitle: '',\n        acceptanceContent: '',\n        materialsPath: ''\n      },\n      // 表单校验\n      rules: {\n        acceptanceTitle: [\n          { required: true, message: \"验收标题不能为空\", trigger: \"blur\" }\n        ],\n        acceptanceContent: [\n          { required: true, message: \"验收内容不能为空\", trigger: \"blur\" }\n        ]\n      },\n      // 查看表单\n      viewForm: {},\n      // 验收表单\n      acceptanceForm: {\n        id: null,\n        score: 5,\n        opinion: '',\n        status: '1'\n      },\n      // 验收表单校验\n      acceptanceRules: {\n        score: [\n          { required: true, message: \"验收评分不能为空\", trigger: \"change\" }\n        ],\n        opinion: [\n          { required: true, message: \"验收意见不能为空\", trigger: \"blur\" }\n        ],\n        status: [\n          { required: true, message: \"验收结果不能为空\", trigger: \"change\" }\n        ]\n      },\n      // 文件列表\n      fileList: [],\n      // 评分颜色\n      colors: ['#99A9BF', '#F7BA2A', '#FF9900'],\n      // 上传头部\n      headers: {\n        Authorization: 'Bearer ' + getToken()\n      }\n    };\n  },\n  created() {\n    this.projectId = this.$route.params.projectId;\n    this.queryParams.projectId = this.projectId;\n    this.form.projectId = this.projectId;\n    this.getProjectInfo();\n    this.getList();\n  },\n  methods: {\n    checkPermission,\n    // 获取项目信息\n    getProjectInfo() {\n      getProjectInfo(this.projectId).then(response => {\n        this.projectInfo = response.data;\n      });\n    },\n    // 获取验收记录列表\n    getList() {\n      this.loading = true;\n      listAcceptance(this.queryParams).then(response => {\n        this.acceptanceList = response.rows;\n        this.total = response.total;\n        this.loading = false;\n      });\n    },\n    // 取消按钮\n    cancel() {\n      this.$router.push({ path: '/project/info' });\n    },\n    // 提交表单\n    submitForm() {\n      this.$refs[\"form\"].validate(valid => {\n        if (valid) {\n          addAcceptance(this.form).then(response => {\n            this.$modal.msgSuccess(\"申请提交成功\");\n            this.getList();\n            this.form.acceptanceTitle = '';\n            this.form.acceptanceContent = '';\n            this.form.materialsPath = '';\n            this.fileList = [];\n          });\n        }\n      });\n    },\n    // 查看验收详情\n    handleView(row) {\n      this.reset();\n      this.open = true;\n      this.isAcceptance = false;\n      this.title = \"验收详情\";\n\n      getAcceptance(row.id).then(response => {\n        this.viewForm = response.data;\n      });\n    },\n    // 进行验收\n    handleAcceptance(row) {\n      this.reset();\n      this.open = true;\n      this.isAcceptance = true;\n      this.title = \"项目验收\";\n\n      getAcceptance(row.id).then(response => {\n        this.viewForm = response.data;\n        this.acceptanceForm.id = row.id;\n      });\n    },\n    // 提交验收结果\n    submitAcceptance() {\n      this.$refs[\"acceptanceForm\"].validate(valid => {\n        if (valid) {\n          completeAcceptance(this.acceptanceForm).then(response => {\n            this.$modal.msgSuccess(\"验收完成\");\n            this.open = false;\n            this.getList();\n          });\n        }\n      });\n    },\n    // 重置表单\n    reset() {\n      this.viewForm = {};\n      this.acceptanceForm = {\n        id: null,\n        score: 5,\n        opinion: '',\n        status: '1'\n      };\n      this.isAcceptance = false;\n    },\n    // 文件上传成功\n    handleUploadSuccess(response, file, fileList) {\n      this.form.materialsPath = response.url;\n      this.$modal.msgSuccess(\"上传成功\");\n    },\n    // 文件删除\n    handleRemove(file, fileList) {\n      this.form.materialsPath = '';\n    },\n    // 文件预览\n    handlePreview(file) {\n      window.open(file.url);\n    },\n    // 上传前检查\n    beforeUpload(file) {\n      const isLt10M = file.size / 1024 / 1024 < 10;\n      if (!isLt10M) {\n        this.$message.error('上传文件大小不能超过 10MB!');\n        return false;\n      }\n      return true;\n    }\n  }\n};\n</script>\n\n<style scoped>\n.mt20 {\n  margin-top: 20px;\n}\n</style>\n"]}]}