{"remainingRequest":"D:\\Code\\Research\\research-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Code\\Research\\research-ui\\src\\views\\project\\approval\\index.vue?vue&type=style&index=0&id=872ae754&scoped=true&lang=css","dependencies":[{"path":"D:\\Code\\Research\\research-ui\\src\\views\\project\\approval\\index.vue","mtime":1740901135535},{"path":"D:\\Code\\Research\\research-ui\\node_modules\\css-loader\\dist\\cjs.js","mtime":1740793408139},{"path":"D:\\Code\\Research\\research-ui\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1740793417979},{"path":"D:\\Code\\Research\\research-ui\\node_modules\\postcss-loader\\src\\index.js","mtime":1740793410952},{"path":"D:\\Code\\Research\\research-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1740793404454},{"path":"D:\\Code\\Research\\research-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":1740793415933}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5hcHBseS1jb250ZW50IHsKICBwYWRkaW5nOiAxMHB4OwogIGJhY2tncm91bmQtY29sb3I6ICNmOWY5Zjk7CiAgYm9yZGVyOiAxcHggc29saWQgI2VlZTsKICBib3JkZXItcmFkaXVzOiA0cHg7CiAgbWluLWhlaWdodDogMTAwcHg7Cn0KLm10MjAgewogIG1hcmdpbi10b3A6IDIwcHg7Cn0KLnRpbWVsaW5lLWNhcmQgewogIG1hcmdpbi1ib3R0b206IDA7Cn0KLnRpbWVsaW5lLXRpdGxlIHsKICBmb250LXdlaWdodDogYm9sZDsKICBtYXJnaW4tYm90dG9tOiA4cHg7Cn0KLnRpbWVsaW5lLWNvbnRlbnQgewogIGNvbG9yOiAjNjY2Owp9Ci50aW1lbGluZS1jb250ZW50IHAgewogIG1hcmdpbjogNXB4IDA7Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsoBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/project/approval","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <el-tabs v-model=\"activeTab\" @tab-click=\"handleTabClick\">\n      <el-tab-pane label=\"待我审批\" name=\"pending\">\n        <el-form :model=\"queryParams\" ref=\"queryForm\" :inline=\"true\" v-show=\"showSearch\" label-width=\"68px\">\n          <el-form-item label=\"项目名称\" prop=\"projectName\">\n            <el-input\n              v-model=\"queryParams.projectName\"\n              placeholder=\"请输入项目名称\"\n              clearable\n              size=\"small\"\n              @keyup.enter.native=\"handleQuery\"\n            />\n          </el-form-item>\n          <el-form-item label=\"申请标题\" prop=\"applyTitle\">\n            <el-input\n              v-model=\"queryParams.applyTitle\"\n              placeholder=\"请输入申请标题\"\n              clearable\n              size=\"small\"\n              @keyup.enter.native=\"handleQuery\"\n            />\n          </el-form-item>\n          <el-form-item>\n            <el-button type=\"primary\" icon=\"el-icon-search\" size=\"mini\" @click=\"handleQuery\">搜索</el-button>\n            <el-button icon=\"el-icon-refresh\" size=\"mini\" @click=\"resetQuery\">重置</el-button>\n          </el-form-item>\n        </el-form>\n\n        <el-table v-loading=\"loading\" :data=\"pendingList\" @selection-change=\"handleSelectionChange\">\n          <el-table-column type=\"selection\" width=\"55\" align=\"center\" />\n          <el-table-column label=\"申请编号\" align=\"center\" prop=\"applyCode\" width=\"120\" />\n          <el-table-column label=\"项目名称\" align=\"center\" prop=\"projectName\" :show-overflow-tooltip=\"true\" />\n          <el-table-column label=\"申请标题\" align=\"center\" prop=\"applyTitle\" :show-overflow-tooltip=\"true\" />\n          <el-table-column label=\"申请人\" align=\"center\" prop=\"applyUserName\" width=\"100\" />\n          <el-table-column label=\"申请部门\" align=\"center\" prop=\"applyDeptName\" width=\"120\" />\n          <el-table-column label=\"申请时间\" align=\"center\" prop=\"applyTime\" width=\"160\" />\n          <el-table-column label=\"当前环节\" align=\"center\" prop=\"approvalStep\" width=\"120\" />\n          <el-table-column label=\"操作\" align=\"center\" class-name=\"small-padding fixed-width\" width=\"160\">\n            <template slot-scope=\"scope\">\n              <el-button\n                size=\"mini\"\n                type=\"text\"\n                icon=\"el-icon-view\"\n                @click=\"handleView(scope.row)\"\n              >查看</el-button>\n              <el-button\n                size=\"mini\"\n                type=\"text\"\n                icon=\"el-icon-check\"\n                @click=\"handleApproval(scope.row)\"\n                v-hasPermi=\"['project:approval:approve']\"\n              >审批</el-button>\n            </template>\n          </el-table-column>\n        </el-table>\n\n        <pagination\n          v-show=\"total > 0\"\n          :total=\"total\"\n          :page.sync=\"queryParams.pageNum\"\n          :limit.sync=\"queryParams.pageSize\"\n          @pagination=\"getList\"\n        />\n      </el-tab-pane>\n\n      <el-tab-pane label=\"我已审批\" name=\"approved\">\n        <el-form :model=\"queryParams\" ref=\"queryFormApproved\" :inline=\"true\" v-show=\"showSearch\" label-width=\"68px\">\n          <el-form-item label=\"项目名称\" prop=\"projectName\">\n            <el-input\n              v-model=\"queryParams.projectName\"\n              placeholder=\"请输入项目名称\"\n              clearable\n              size=\"small\"\n              @keyup.enter.native=\"handleQuery\"\n            />\n          </el-form-item>\n          <el-form-item label=\"申请标题\" prop=\"applyTitle\">\n            <el-input\n              v-model=\"queryParams.applyTitle\"\n              placeholder=\"请输入申请标题\"\n              clearable\n              size=\"small\"\n              @keyup.enter.native=\"handleQuery\"\n            />\n          </el-form-item>\n          <el-form-item label=\"审批结果\" prop=\"approvalResult\">\n            <el-select v-model=\"queryParams.approvalResult\" placeholder=\"请选择审批结果\" clearable size=\"small\">\n              <el-option\n                v-for=\"dict in dict.type.approval_result\"\n                :key=\"dict.value\"\n                :label=\"dict.label\"\n                :value=\"dict.value\"\n              />\n            </el-select>\n          </el-form-item>\n          <el-form-item>\n            <el-button type=\"primary\" icon=\"el-icon-search\" size=\"mini\" @click=\"handleQuery\">搜索</el-button>\n            <el-button icon=\"el-icon-refresh\" size=\"mini\" @click=\"resetQuery\">重置</el-button>\n          </el-form-item>\n        </el-form>\n\n        <el-table v-loading=\"loading\" :data=\"approvedList\">\n          <el-table-column label=\"申请编号\" align=\"center\" prop=\"applyCode\" width=\"120\" />\n          <el-table-column label=\"项目名称\" align=\"center\" prop=\"projectName\" :show-overflow-tooltip=\"true\" />\n          <el-table-column label=\"申请标题\" align=\"center\" prop=\"applyTitle\" :show-overflow-tooltip=\"true\" />\n          <el-table-column label=\"申请人\" align=\"center\" prop=\"applyUserName\" width=\"100\" />\n          <el-table-column label=\"审批环节\" align=\"center\" prop=\"approvalStep\" width=\"120\" />\n          <el-table-column label=\"审批时间\" align=\"center\" prop=\"approvalTime\" width=\"160\" />\n          <el-table-column label=\"审批结果\" align=\"center\" prop=\"approvalResult\" width=\"100\">\n            <template slot-scope=\"scope\">\n              <dict-tag :options=\"dict.type.approval_result\" :value=\"scope.row.approvalResult\"/>\n            </template>\n          </el-table-column>\n          <el-table-column label=\"操作\" align=\"center\" class-name=\"small-padding fixed-width\" width=\"100\">\n            <template slot-scope=\"scope\">\n              <el-button\n                size=\"mini\"\n                type=\"text\"\n                icon=\"el-icon-view\"\n                @click=\"handleView(scope.row)\"\n              >查看</el-button>\n            </template>\n          </el-table-column>\n        </el-table>\n\n        <pagination\n          v-show=\"approvedTotal > 0\"\n          :total=\"approvedTotal\"\n          :page.sync=\"approvedQueryParams.pageNum\"\n          :limit.sync=\"approvedQueryParams.pageSize\"\n          @pagination=\"getApprovedList\"\n        />\n      </el-tab-pane>\n\n      <el-tab-pane label=\"全部审批\" name=\"all\" v-if=\"hasAdminPermission\">\n        <el-form :model=\"allQueryParams\" ref=\"queryFormAll\" :inline=\"true\" v-show=\"showSearch\" label-width=\"68px\">\n          <el-form-item label=\"项目名称\" prop=\"projectName\">\n            <el-input\n              v-model=\"allQueryParams.projectName\"\n              placeholder=\"请输入项目名称\"\n              clearable\n              size=\"small\"\n              @keyup.enter.native=\"handleAllQuery\"\n            />\n          </el-form-item>\n          <el-form-item label=\"申请标题\" prop=\"applyTitle\">\n            <el-input\n              v-model=\"allQueryParams.applyTitle\"\n              placeholder=\"请输入申请标题\"\n              clearable\n              size=\"small\"\n              @keyup.enter.native=\"handleAllQuery\"\n            />\n          </el-form-item>\n          <el-form-item label=\"审批状态\" prop=\"status\">\n            <el-select v-model=\"allQueryParams.status\" placeholder=\"请选择审批状态\" clearable size=\"small\">\n              <el-option\n                v-for=\"dict in dict.type.apply_status\"\n                :key=\"dict.value\"\n                :label=\"dict.label\"\n                :value=\"dict.value\"\n              />\n            </el-select>\n          </el-form-item>\n          <el-form-item>\n            <el-button type=\"primary\" icon=\"el-icon-search\" size=\"mini\" @click=\"handleAllQuery\">搜索</el-button>\n            <el-button icon=\"el-icon-refresh\" size=\"mini\" @click=\"resetAllQuery\">重置</el-button>\n          </el-form-item>\n        </el-form>\n\n        <el-table v-loading=\"allLoading\" :data=\"allList\">\n          <el-table-column label=\"申请编号\" align=\"center\" prop=\"applyCode\" width=\"120\" />\n          <el-table-column label=\"项目名称\" align=\"center\" prop=\"projectName\" :show-overflow-tooltip=\"true\" />\n          <el-table-column label=\"申请标题\" align=\"center\" prop=\"applyTitle\" :show-overflow-tooltip=\"true\" />\n          <el-table-column label=\"申请人\" align=\"center\" prop=\"applyUserName\" width=\"100\" />\n          <el-table-column label=\"申请部门\" align=\"center\" prop=\"applyDeptName\" width=\"120\" />\n          <el-table-column label=\"申请时间\" align=\"center\" prop=\"applyTime\" width=\"160\" />\n          <el-table-column label=\"当前环节\" align=\"center\" prop=\"currentStep\" width=\"120\" />\n          <el-table-column label=\"审批状态\" align=\"center\" prop=\"status\" width=\"100\">\n            <template slot-scope=\"scope\">\n              <dict-tag :options=\"dict.type.apply_status\" :value=\"scope.row.status\"/>\n            </template>\n          </el-table-column>\n          <el-table-column label=\"操作\" align=\"center\" class-name=\"small-padding fixed-width\" width=\"100\">\n            <template slot-scope=\"scope\">\n              <el-button\n                size=\"mini\"\n                type=\"text\"\n                icon=\"el-icon-view\"\n                @click=\"handleView(scope.row)\"\n              >查看</el-button>\n            </template>\n          </el-table-column>\n        </el-table>\n\n        <pagination\n          v-show=\"allTotal > 0\"\n          :total=\"allTotal\"\n          :page.sync=\"allQueryParams.pageNum\"\n          :limit.sync=\"allQueryParams.pageSize\"\n          @pagination=\"getAllList\"\n        />\n      </el-tab-pane>\n    </el-tabs>\n\n    <!-- 查看对话框 -->\n    <el-dialog :title=\"title\" :visible.sync=\"open\" width=\"900px\" append-to-body>\n      <el-row>\n        <el-col :span=\"24\">\n          <el-card class=\"box-card\">\n            <div slot=\"header\" class=\"clearfix\">\n              <span>申请信息</span>\n            </div>\n            <el-descriptions :column=\"3\" border>\n              <el-descriptions-item label=\"申请编号\">{{ form.applyCode }}</el-descriptions-item>\n              <el-descriptions-item label=\"项目名称\">{{ form.projectName }}</el-descriptions-item>\n              <el-descriptions-item label=\"项目类型\">\n                <dict-tag :options=\"dict.type.project_type\" :value=\"form.projectType\"/>\n              </el-descriptions-item>\n              <el-descriptions-item label=\"申请标题\">{{ form.applyTitle }}</el-descriptions-item>\n              <el-descriptions-item label=\"申请人\">{{ form.applyUserName }}</el-descriptions-item>\n              <el-descriptions-item label=\"申请部门\">{{ form.applyDeptName }}</el-descriptions-item>\n              <el-descriptions-item label=\"申请时间\">{{ form.applyTime }}</el-descriptions-item>\n              <el-descriptions-item label=\"审批状态\">\n                <dict-tag :options=\"dict.type.apply_status\" :value=\"form.status\"/>\n              </el-descriptions-item>\n              <el-descriptions-item label=\"当前环节\">{{ form.currentStep }}</el-descriptions-item>\n            </el-descriptions>\n\n            <div class=\"mt20\">\n              <el-divider content-position=\"left\">申请内容</el-divider>\n              <div class=\"apply-content\" v-html=\"form.applyContent\"></div>\n            </div>\n          </el-card>\n        </el-col>\n      </el-row>\n\n      <el-row class=\"mt20\">\n        <el-col :span=\"24\">\n          <el-card class=\"box-card\">\n            <div slot=\"header\" class=\"clearfix\">\n              <span>审批流程</span>\n            </div>\n            <el-steps :active=\"activeStep\" :process-status=\"processStatus\" finish-status=\"success\" align-center>\n              <el-step\n                v-for=\"(step, index) in approvalSteps\"\n                :key=\"index\"\n                :title=\"step.stepName\"\n                :description=\"getStepDescription(step)\"\n              ></el-step>\n            </el-steps>\n\n            <el-timeline class=\"mt20\">\n              <el-timeline-item\n                v-for=\"(history, index) in approvalHistory\"\n                :key=\"index\"\n                :timestamp=\"history.approvalTime\"\n                :type=\"getTimelineItemType(history.approvalResult)\"\n                :color=\"getTimelineItemColor(history.approvalResult)\"\n              >\n                <el-card class=\"timeline-card\">\n                  <div class=\"timeline-title\">\n                    <span>{{ history.approvalStep }}</span>\n                    <span style=\"float: right;\">\n                      <dict-tag :options=\"dict.type.approval_result\" :value=\"history.approvalResult\"/>\n                    </span>\n                  </div>\n                  <div class=\"timeline-content\">\n                    <p><strong>审批人：</strong>{{ history.approvalUserName }}</p>\n                    <p><strong>审批意见：</strong>{{ history.approvalOpinion || '无' }}</p>\n                  </div>\n                </el-card>\n              </el-timeline-item>\n            </el-timeline>\n          </el-card>\n        </el-col>\n      </el-row>\n\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"open = false\">关 闭</el-button>\n      </div>\n    </el-dialog>\n\n    <!-- 审批对话框 -->\n    <el-dialog title=\"审批处理\" :visible.sync=\"approvalOpen\" width=\"500px\" append-to-body>\n      <el-form ref=\"approvalForm\" :model=\"approvalForm\" :rules=\"approvalRules\" label-width=\"100px\">\n        <el-form-item label=\"申请标题\">\n          <el-input v-model=\"approvalForm.applyTitle\" disabled />\n        </el-form-item>\n        <el-form-item label=\"审批环节\">\n          <el-input v-model=\"approvalForm.approvalStep\" disabled />\n        </el-form-item>\n        <el-form-item label=\"审批意见\" prop=\"approvalOpinion\">\n          <el-input type=\"textarea\" v-model=\"approvalForm.approvalOpinion\" :rows=\"4\" placeholder=\"请输入审批意见\" />\n        </el-form-item>\n        <el-form-item label=\"审批结果\" prop=\"approvalResult\">\n          <el-radio-group v-model=\"approvalForm.approvalResult\">\n            <el-radio label=\"1\">通过</el-radio>\n            <el-radio label=\"2\">驳回</el-radio>\n            <el-radio label=\"3\" v-if=\"canReturn\">退回</el-radio>\n          </el-radio-group>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button type=\"primary\" @click=\"submitApproval\">确 定</el-button>\n        <el-button @click=\"approvalOpen = false\">取 消</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport {\n  listPendingApproval,\n  listApprovedApproval,\n  listAllApproval,\n  getApprovalDetail,\n  approve,\n  reject,\n  returnApproval\n} from \"@/api/project/approval\";\nimport { getApprovalHistory, getApprovalSteps } from \"@/api/project/approval\";\nimport { getUserProfile } from \"@/api/system/user\";\n\nexport default {\n  name: \"ProjectApproval\",\n  dicts: ['approval_result', 'apply_status', 'project_type'],\n  data() {\n    return {\n      // 遮罩层\n      loading: false,\n      allLoading: false,\n      // 选中数组\n      ids: [],\n      // 非单个禁用\n      single: true,\n      // 非多个禁用\n      multiple: true,\n      // 显示搜索条件\n      showSearch: true,\n      // 总条数\n      total: 0,\n      approvedTotal: 0,\n      allTotal: 0,\n      // 表格数据\n      pendingList: [],\n      approvedList: [],\n      allList: [],\n      // 弹出层标题\n      title: \"\",\n      // 是否显示弹出层\n      open: false,\n      approvalOpen: false,\n      // 是否为管理员\n      hasAdminPermission: false,\n      // 当前激活的选项卡\n      activeTab: 'pending',\n      // 查询参数\n      queryParams: {\n        pageNum: 1,\n        pageSize: 10,\n        projectName: null,\n        applyTitle: null\n      },\n      approvedQueryParams: {\n        pageNum: 1,\n        pageSize: 10,\n        projectName: null,\n        applyTitle: null,\n        approvalResult: null\n      },\n      allQueryParams: {\n        pageNum: 1,\n        pageSize: 10,\n        projectName: null,\n        applyTitle: null,\n        status: null\n      },\n      // 表单参数\n      form: {},\n      // 审批表单参数\n      approvalForm: {\n        id: null,\n        applyId: null,\n        applyTitle: '',\n        approvalStep: '',\n        approvalOpinion: '',\n        approvalResult: '1'\n      },\n      // 审批表单校验\n      approvalRules: {\n        approvalOpinion: [\n          { required: true, message: \"审批意见不能为空\", trigger: \"blur\" }\n        ],\n        approvalResult: [\n          { required: true, message: \"请选择审批结果\", trigger: \"change\" }\n        ]\n      },\n      // 审批流程步骤\n      approvalSteps: [],\n      // 当前激活的步骤\n      activeStep: 0,\n      // 流程状态\n      processStatus: 'process',\n      // 审批历史\n      approvalHistory: [],\n      // 是否可以退回\n      canReturn: false\n    };\n  },\n  created() {\n    this.getList();\n    this.checkAdminPermission();\n  },\n  methods: {\n    // 检查是否有管理员权限\n    checkAdminPermission() {\n      getUserProfile().then(response => {\n        const { roles } = response.data;\n        this.hasAdminPermission = roles.some(role => role.roleKey === 'admin');\n      });\n    },\n    // 选项卡切换\n    handleTabClick(tab) {\n      if (tab.name === 'pending') {\n        this.getList();\n      } else if (tab.name === 'approved') {\n        this.getApprovedList();\n      } else if (tab.name === 'all' && this.hasAdminPermission) {\n        this.getAllList();\n      }\n    },\n    // 多选框选中数据\n    handleSelectionChange(selection) {\n      this.ids = selection.map(item => item.id);\n      this.single = selection.length !== 1;\n      this.multiple = !selection.length;\n    },\n    // 查询待我审批列表\n    getList() {\n      this.loading = true;\n      listPendingApproval(this.queryParams).then(response => {\n        this.pendingList = response.rows;\n        this.total = response.total;\n        this.loading = false;\n      });\n    },\n    // 查询我已审批列表\n    getApprovedList() {\n      this.loading = true;\n      listApprovedApproval(this.approvedQueryParams).then(response => {\n        this.approvedList = response.rows;\n        this.approvedTotal = response.total;\n        this.loading = false;\n      });\n    },\n    // 查询全部审批列表\n    getAllList() {\n      this.allLoading = true;\n      listAllApproval(this.allQueryParams).then(response => {\n        this.allList = response.rows;\n        this.allTotal = response.total;\n        this.allLoading = false;\n      });\n    },\n    // 待我审批 - 搜索按钮操作\n    handleQuery() {\n      this.queryParams.pageNum = 1;\n      if (this.activeTab === 'pending') {\n        this.getList();\n      } else if (this.activeTab === 'approved') {\n        this.getApprovedList();\n      }\n    },\n    // 全部审批 - 搜索按钮操作\n    handleAllQuery() {\n      this.allQueryParams.pageNum = 1;\n      this.getAllList();\n    },\n    // 待我审批 - 重置按钮操作\n    resetQuery() {\n      if (this.activeTab === 'pending') {\n        this.resetForm(\"queryForm\");\n        this.handleQuery();\n      } else if (this.activeTab === 'approved') {\n        this.resetForm(\"queryFormApproved\");\n        this.handleQuery();\n      }\n    },\n    // 全部审批 - 重置按钮操作\n    resetAllQuery() {\n      this.resetForm(\"queryFormAll\");\n      this.handleAllQuery();\n    },\n    // 查看详情\n    handleView(row) {\n      this.reset();\n      this.open = true;\n      this.title = \"审批详情\";\n      getApprovalDetail(row.applyId || row.id).then(response => {\n        this.form = response.data;\n        // 获取审批流程信息\n        this.getApprovalSteps(this.form.applyId || this.form.id);\n        // 获取审批历史\n        this.getApprovalHistory(this.form.applyId || this.form.id);\n      });\n    },\n    // 获取审批流程步骤\n    getApprovalSteps(applyId) {\n      getApprovalSteps(applyId).then(response => {\n        this.approvalSteps = response.data;\n        // 计算当前激活的步骤\n        this.calculateActiveStep();\n      });\n    },\n    // 获取审批历史\n    getApprovalHistory(applyId) {\n      getApprovalHistory(applyId).then(response => {\n        this.approvalHistory = response.data;\n      });\n    },\n    // 计算当前激活的步骤\n    calculateActiveStep() {\n      if (!this.approvalSteps || !this.approvalSteps.length) {\n        this.activeStep = 0;\n        return;\n      }\n\n      // 根据状态和当前步骤计算activeStep\n      if (this.form.status === '3') { // 已通过\n        this.activeStep = this.approvalSteps.length;\n        this.processStatus = 'success';\n      } else if (this.form.status === '4') { // 已驳回\n        for (let i = 0; i < this.approvalSteps.length; i++) {\n          if (this.approvalSteps[i].stepKey === this.form.currentStep) {\n            this.activeStep = i;\n            this.processStatus = 'error';\n            break;\n          }\n        }\n      } else { // 审批中\n        for (let i = 0; i < this.approvalSteps.length; i++) {\n          if (this.approvalSteps[i].stepKey === this.form.currentStep) {\n            this.activeStep = i;\n            this.processStatus = 'process';\n            break;\n          }\n        }\n      }\n    },\n    // 获取步骤描述\n    getStepDescription(step) {\n      if (step.approvalUserName) {\n        return `${step.approvalUserName} ${step.approvalTime || ''}`;\n      }\n      return '';\n    },\n    // 获取时间线项类型\n    getTimelineItemType(result) {\n      const resultMap = {\n        '1': 'success',   // 通过\n        '2': 'danger',    // 驳回\n        '3': 'warning'    // 退回\n      };\n      return resultMap[result] || 'info';\n    },\n    // 获取时间线项颜色\n    getTimelineItemColor(result) {\n      const colorMap = {\n        '1': '#67C23A',   // 通过\n        '2': '#F56C6C',   // 驳回\n        '3': '#E6A23C'    // 退回\n      };\n      return colorMap[result] || '#909399';\n    },\n    // 审批操作\n    handleApproval(row) {\n      this.resetApprovalForm();\n      this.approvalOpen = true;\n      this.approvalForm.id = row.id;\n      this.approvalForm.applyId = row.applyId;\n      this.approvalForm.applyTitle = row.applyTitle;\n      this.approvalForm.approvalStep = row.approvalStep;\n\n      // 检查是否可以退回\n      getApprovalHistory(row.applyId).then(response => {\n        const history = response.data;\n        // 如果有审批历史，则可以退回\n        this.canReturn = history && history.length > 0;\n      });\n    },\n    // 重置表单\n    reset() {\n      this.form = {};\n      this.approvalSteps = [];\n      this.activeStep = 0;\n      this.processStatus = 'process';\n      this.approvalHistory = [];\n    },\n    // 重置审批表单\n    resetApprovalForm() {\n      this.approvalForm = {\n        id: null,\n        applyId: null,\n        applyTitle: '',\n        approvalStep: '',\n        approvalOpinion: '',\n        approvalResult: '1'\n      };\n      this.canReturn = false;\n    },\n    // 提交审批\n    submitApproval() {\n      this.$refs[\"approvalForm\"].validate(valid => {\n        if (valid) {\n          if (this.approvalForm.approvalResult === '1') {\n            // 通过\n            approve(this.approvalForm.id, this.approvalForm).then(response => {\n              this.$modal.msgSuccess(\"审批已通过\");\n              this.approvalOpen = false;\n              this.getList();\n            });\n          } else if (this.approvalForm.approvalResult === '2') {\n            // 驳回\n            reject(this.approvalForm.id, this.approvalForm).then(response => {\n              this.$modal.msgSuccess(\"审批已驳回\");\n              this.approvalOpen = false;\n              this.getList();\n            });\n          } else if (this.approvalForm.approvalResult === '3') {\n            // 退回\n            returnApproval(this.approvalForm.id, this.approvalForm).then(response => {\n              this.$modal.msgSuccess(\"审批已退回\");\n              this.approvalOpen = false;\n              this.getList();\n            });\n          }\n        }\n      });\n    }\n  }\n};\n</script>\n\n<style scoped>\n.apply-content {\n  padding: 10px;\n  background-color: #f9f9f9;\n  border: 1px solid #eee;\n  border-radius: 4px;\n  min-height: 100px;\n}\n.mt20 {\n  margin-top: 20px;\n}\n.timeline-card {\n  margin-bottom: 0;\n}\n.timeline-title {\n  font-weight: bold;\n  margin-bottom: 8px;\n}\n.timeline-content {\n  color: #666;\n}\n.timeline-content p {\n  margin: 5px 0;\n}\n</style>\n"]}]}